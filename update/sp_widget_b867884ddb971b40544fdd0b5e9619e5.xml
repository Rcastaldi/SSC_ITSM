<?xml version="1.0" encoding="UTF-8"?>
<record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <client_script><![CDATA[function($scope, spUtil, $http) {
	/* widget controller */
	var c = this;

	c.locations = [];
	c.data.location = '';
	c.selected = {value: c.locations[0]};
	c.refreshLocation = function(query){
		if(query) {
			c.server.get({
				action: 'searchLocation',
				query: query
			}).then(function(response){
				c.locations = response.data.locations;
			});
		}
	}
	c.onSelectCallback = function(item, model) {
		c.data.location = item.sys_id;
	}
	c.remove = function (item) {
		var index = c.data.files.indexOf(item);
		c.data.files.splice(index, 1);
	}
	
}]]></client_script>
        <controller_as>c</controller_as>
        <css/>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>true</has_preview>
        <id>ssc-sp-widget-end-user-filter</id>
        <internal>false</internal>
        <link/>
        <name>SSC End-User Filter</name>
        <option_schema/>
        <public>false</public>
        <roles/>
        <script><![CDATA[(function() {	

	var locations = [];

	if(input && input.action === 'searchLocation'){
		var grl = new GlideRecord('cmn_location');	
		if(options.locations_query){
			grl.addEncodedQuery(options.locations_query);
		}
		grl.addQuery('name', 'CONTAINS', input.query);
		grl.setLimit(20);
		grl.query();
		while(grl.next()){
			locations.push({
				name: grl.name.toString(),
				sys_id: grl.sys_id.toString()
			});
		}
		data.locations = locations;
		return data;
	}

})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>e448614</sys_created_by>
        <sys_created_on>2018-07-12 14:55:15</sys_created_on>
        <sys_customer_update>true</sys_customer_update>
        <sys_id>b867884ddb971b40544fdd0b5e9619e5</sys_id>
        <sys_mod_count>14</sys_mod_count>
        <sys_name>SSC End-User Filter</sys_name>
        <sys_package display_value="State Street IT Service Management" source="x_ibmss_ssc_itsm">2a92e67fdb071740544fdd0b5e9619d7</sys_package>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="State Street IT Service Management">2a92e67fdb071740544fdd0b5e9619d7</sys_scope>
        <sys_update_name>sp_widget_b867884ddb971b40544fdd0b5e9619e5</sys_update_name>
        <sys_updated_by>e448614</sys_updated_by>
        <sys_updated_on>2018-07-12 15:55:28</sys_updated_on>
        <template><![CDATA[<div>
  <sp-panel title="options.title" body-class="'list-group'">

    <div id="name-group" class="form-group" ng-class="{'has-error' : SafetyForm.location.$invalid && !SafetyForm.location.$pristine}">
      <label>Location*</label>
      <ui-select ng-model="c.selected.value" on-select="c.onSelectCallback($item, $model)" ng-required="true">
        <ui-select-match>
          <span ng-bind="$select.selected.name"></span>
        </ui-select-match>
        <ui-select-choices ng-repeat="item in (c.locations | filter: $select.search) track by item.sys_id" refresh="c.refreshLocation($select.search)" refresh-delay="0">
         <span ng-bind="item.name"></span>
        </ui-select-choices>
      </ui-select>
      <span class="help-block" ng-show="SafetyForm.location.$invalid && !SafetyForm.location.$pristine">
        Please describe the location.
      </span>
    </div>

  </sp-panel>
</div>]]></template>
    </sp_widget>
</record_update>
